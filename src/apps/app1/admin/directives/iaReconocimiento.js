angular.module("APP-CLASIFICADOR-ADMIN").directive("iaReconocimiento",["PARAMETROS","$timeout","AppModelService",function(e,a,r){return{restrict:"AE",replace:!0,require:"ngModel",link:function(t,n,o,i){function l(){t.currentPatron.accion=null}t.MODE="agregar",t.linkComplete=!1,t.iaName=o.iaName?o.iaName:"",t.mode=o.mode?o.mode:t.MODE,t.form_valid=!1,t.get_list_patron_tipo=[],t.get_list_patron_recupera=[],t.dx={activo:null,urlSemilla:null,ArrayUrlSeguimiento:[],ArrayKeyWords:[]},t.itemBase=null,t.currentPatron={tipo:{id:"",nombre:"*SELECCIONE"},recupera:{id:"",nombre:"*SELECCIONE"},atributo:null,patron:null,accion:null},i.$render=function(){if(i&&i.$modelValue&&t.linkComplete){i.$modelValue.data={valid:!1};var e=i.$modelValue;t.dx.activo=!0===e.activo?"true":!1===e.activo?"false":null,t.dx.urlSemilla=e.urlSemilla?angular.copy(e.urlSemilla):null,t.dx.ArrayUrlSeguimiento=e.urlSeguimiento?angular.copy(e.urlSeguimiento):[],t.dx.ArrayKeyWords=e.keyWords?angular.copy(e.keyWords):[],t.dx.patrones=e.patrones?angular.copy(e.patrones):[]}},t.validate=function(){return t.form_valid=t.this_form.$valid&&t.dx.patrones.length>=1,t.form_valid},t.aceptar=function(){angular.forEach(t.dx.patrones,(function(e){delete e.selected}));var a=t.validate(),r={activo:g_utils.is_true(t.dx.activo),urlSemilla:angular.copy(t.dx.urlSemilla),urlSeguimiento:g_utils.getKeywordListString(t.dx.ArrayUrlSeguimiento),keyWords:g_utils.getKeywordListString(t.dx.ArrayKeyWords),patrones:angular.copy(t.dx.patrones)},n={name:t.iaName,action:"aceptar",mode:o.mode,data:r,valid:a};t.$emit(e.EVENTOS.ia_reconocimiento_event,n)},t.cancelar=function(){var a={name:t.iaName,action:"cancelar",mode:o.mode};t.$emit(e.EVENTOS.ia_reconocimiento_event,a)},t.agregarPatron=function(){t.currentPatron={accion:"agregar",tipo:{id:"",nombre:"*SELECCIONE"},recupera:{id:"",nombre:"*SELECCIONE"},atributo:null,patron:null}},t.editarPatron=function(e){var a=t.get_list_patron_tipo.getItem("id",e.id),r=t.get_list_patron_recupera.getItem("id",e.recupera);angular.forEach(t.dx.patrones,(function(e){delete e.selected})),e.selected=!0,t.itemBase=e,t.currentPatron={accion:"editar",tipo:a||{id:"",nombre:"*SELECCIONE"},recupera:r||{id:"",nombre:"*SELECCIONE"},atributo:angular.copy(e.atributo),patron:angular.copy(e.patron)}},t.aceptarAgregar=function(){var e={id:t.currentPatron.tipo.id,recupera:t.currentPatron.recupera.id,atributo:t.currentPatron.atributo,patron:t.currentPatron.patron};t.dx.patrones.push(e),l()},t.aceptarEditar=function(){t.itemBase.id=angular.copy(t.currentPatron.tipo.id),t.itemBase.recupera=angular.copy(t.currentPatron.recupera.id),t.itemBase.atributo=angular.copy(t.currentPatron.atributo),t.itemBase.patron=angular.copy(t.currentPatron.patron),l()},t.cancelarPatron=function(){l()},a((function(){r.getJsonList(e.URL.get_list_patron_tipo,(function(e){t.get_list_patron_tipo=e.data.data})),r.getJsonList(e.URL.get_list_patron_recupera,(function(e){t.get_list_patron_recupera=e.data.data}))})),t.linkComplete=!0},scope:{},templateUrl:"apps/app1/admin/directives/templates/iaReconocimiento.html"}}]);