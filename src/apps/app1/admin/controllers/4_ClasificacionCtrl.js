angular.module("APP-CLASIFICADOR-ADMIN").controller("4_ClasificacionCtrl",["AppModelService","$rootScope","$scope","$location","CommonAjaxService","CommonLog","PARAMETROS",function(a,o,i,t,e,c,n){o.currentViewName="Bloque 4";var s=["","EVENTO DEL D√çA","CASO","AGENDA"];function l(a,o,t){i.lblPasoActual=a||"",i.lblPasoSiguiente=o||"",i.lblPasoPostSiguiente=t||""}i.PCT_FIJO=33,i.TITLES=s,i.pasoLast=4,i.pasoBase=0,i.nombreEtapa="CLASIFICACI&Oacute;N DE LA<br>UNIDAD DE INFORMACI&Oacute;N",i.lblPasoActual="",i.lblPasoSiguiente="",i.lblPasoPostSiguiente="",i.$watch("pasoBase",(function(){i.update_menu()})),i.$parent.app_model.completitud_etapa.etapa_actual=a.CONSTANTE.CLASIFICACION,i.update_menu=function(){switch(i.$parent.app_model.completitud_etapa.clasificacion.porcentajeCompletez=(i.pasoBase-1)*i.PCT_FIJO+"%",i.pasoBase){case 1:l(s[1],s[2],s[3]);break;case 2:l(s[2],s[3],s[4]);break;case 3:l(s[3],s[4]);break;case 4:l(s[4]);break;default:l();break}},i.etapaCompletada=function(){i.pasoBase=i.pasoLast},i.$on(n.EVENTOS.clasificacion_complete,(function(a,o){var t=i.Notificaciones.getItem("id_nota",o.idNota);if(t){var e=i.Notificaciones.getIndex("id_nota",t.id_nota);e>=0&&function(a){i.Notificaciones.splice(a,1)}(e)}})),i.verNota=function(a,o,e){angular.forEach(i.Notificaciones,(function(a,o){delete a.selected})),o.selected=!0,i.app_model.NOTA=o,i.clasificacion.idNota=o.id_nota,i.clasificacion.idCaso="",i.clasificacion.idEvento="",i.clasificacion.idAgenda="",i.clasificacion.tema=[],i.clasificacion.tiempoDeCaptura="",i.$broadcast(n.EVENTOS.restart_clasificacion,{}),o.faltaAgenda?t.path("/clasificacion/agenda"):t.path("/clasificacion/reload")},i.loadData=function(a){if(0===a&&(i.Notificaciones=[],i.hay_mas_datos=!0,i.numeroDePagina=0,i.totalRes=0),i.hay_mas_datos){i.numeroDePagina++;var t={usuario:o.globals.infoUser.usuario,numeroDePagina:i.numeroDePagina,numeroDeResultados:n.LIST_CLASIF_BLOQ3_RESULTS_BY_PAGE},s=function(a){var o=a.data.data;o.length>0?(i.hay_mas_datos=!0,i.totalRes=o[0].totalRes?o[0].totalRes:o.length,i.Notificaciones=i.Notificaciones.concat(o)):i.hay_mas_datos=!1,i.loadingData=!1};i.loadingData=!0,"SERVICE"===n.URL.get_list_clasificadas.FORCE?e.post(n.URL.get_list_clasificadas_bloque3,t).then((function(a){a.data.success&&s(a)}),(function(a){i.loadingData=!1,c.logAjaxError(a,n.URL.get_list_clasificadas_bloque3)})):e.get(n.URL.get_list_clasificadas_bloque3,t).then((function(a){a.data.success&&s(a)}),(function(a){i.loadingData=!1,c.logAjaxError(a,n.URL.get_list_clasificadas_bloque3)}))}},i.logout=function(){t.path(n.APP1.ACTION.LOGIN)},i.loadData(0)}]);