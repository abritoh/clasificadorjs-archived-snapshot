angular.module("APP-CLASIFICADOR-ADMIN").controller("ClasificadosCtrl",["$rootScope","$scope","$location","CONFIG","PARAMETROS","CommonAjaxService","CommonLog","AppModelService","MediaService",function(a,o,e,i,t,n,s,c,l){a.currentViewName="Principal - Clasificados",o.avail=!0,o.n_data={},o.n_detail=null,o.n_resources=[],o.Notificaciones=[],o.palabrasClave=[],o.loading_detalle=!1,o.hay_mas_datos=!0,o.numeroDePagina=0,o.totalRes=0,o.loadingData=!0,o.verNotificacion=function(a,e){angular.forEach(o.Notificaciones,(function(a,o){delete a.selected})),this.item.selected=!0,o.n_data=this.item,o.palabrasClave=angular.copy(o.n_data.palabrascve),$("#treeData").html(g_utils.crlf_to_br(o.n_data.cuerpo))},o.logout=function(){e.path(t.APP1.ACTION.LOGIN)},o.irEventos=function(){e.path("eventoDelDia")},o.$on(t.EVENTOS.bandeja_clasificador_adm,(function(a,e){o.$apply((function(){var a,i,t,n;i=(a=e).id_nota,(t=o.Notificaciones.getIndex("id_nota",i))>=0&&(n=t,o.Notificaciones.splice(n,1),o.totalRes-=1,o.n_data&&o.n_data.id_nota===i&&o.verNotificacion(null,a)),o.Notificaciones.unshift(e),o.totalRes+=1}))})),o.getFormatoArchivo=function(a){var o=a.substring(a.lastIndexOf(".")).toLowerCase();return i.FORMATOS_ARCHIVO[o]?{esValido:!0,icono:i.FORMATOS_ARCHIVO[o]}:{esValido:!0,icono:i.FORMATOS_ARCHIVO.def}},o.createImageList=function(){if(o.n_data){var a=[];e(o.n_data.imagenes,i.FILE_TYPE.imagen),e(o.n_data.videos,i.FILE_TYPE.video),e(o.n_data.audios,i.FILE_TYPE.audio),e(o.n_data.documentos,i.FILE_TYPE.documento),o.n_resources=a}function e(e,t){var n=null,s=null;if(e&&angular.isArray(e))for(var c=0;c<e.length;c++){var l={};switch(t){case i.FILE_TYPE.imagen:l.fileType=i.FILE_TYPE.imagen,l.url=e[c],l.url2=e[c],a.push(l);break;case i.FILE_TYPE.video:l.fileType=i.FILE_TYPE.video,l.url=e[c],l.url2=i.GENERIC_ICON.video,a.push(l);break;case i.FILE_TYPE.audio:l.fileType=i.FILE_TYPE.audio,l.url=e[c],l.url2=i.GENERIC_ICON.audio,a.push(l);break;case i.FILE_TYPE.documento:l.fileType=i.FILE_TYPE.documento,n=e[c],s=o.getFormatoArchivo(n),l.url=e[c],l.url2=s.icono,a.push(l);break}}}},o.showResource=function(a){l.showResource(a.url,a.fileType)},o.loadData=function(a){if(0===a&&(o.Notificaciones=[],o.hay_mas_datos=!0,o.numeroDePagina=0,o.totalRes=0),o.hay_mas_datos){o.numeroDePagina++;var e={numeroDePagina:o.numeroDePagina,numeroDeResultados:t.LIST_CLASIF_RESULTS_BY_PAGE},i=function(a){var e=a.data.data;e.length>0?(o.hay_mas_datos=!0,o.totalRes=e[0].totalRes?e[0].totalRes:e.length,o.Notificaciones=e):o.hay_mas_datos=!1,o.loadingData=!1};o.loadingData=!0,"SERVICE"===t.URL.get_list_clasificadas.FORCE?n.post(t.URL.get_list_clasificadas,e).then((function(a){a.data.success&&i(a)}),(function(a){o.loadingData=!1,s.logAjaxError(a,t.URL.get_list_clasificadas)})):n.get(t.URL.get_list_clasificadas,e).then((function(a){a.data.success&&i(a)}),(function(a){o.loadingData=!1,s.logAjaxError(a,t.URL.get_list_clasificadas)}))}},o.loadData(0)}]);