angular.module("APP-CLASIFICADOR-ADMIN").controller("Paso_4_03Ctrl",["$scope","$location","PARAMETROS","AppModelService",function(a,i,o,t){a.$parent.pasoBase=3;function c(){g_utils.prompt_msg(o.MSG.FMT_ERR_PERSISTENCIA_BLOQUE_4,(function(){}))}a.toComplete=!0,a.dx={categoria:{idTipoCategoria:null,idSubTipoCategoria:null,idSubSubTipoCategoria:null,idSubSubSubTipoCategoria:null}},a.acceptCategoria=function(){var i;a.isAgenda&&a.dx.categoria.data.valid&&(a.toComplete=!1,a.cateCompleted=!0,a.clasificacion.idAgenda=(i=a.dx.categoria,g_utils.firstNotNull(i.idSubSubSubTipoCategoria,i.idSubSubTipoCategoria,i.idSubTipoCategoria,i.idTipoCategoria))),!1===a.isAgenda&&(a.toComplete=!1,a.cateCompleted=!0,a.clasificacion.idAgenda="")},a.aceptar=function(e){a.cateCompleted&&(a.clasificacion.tiempoDeCaptura=a.app_model.completitud_etapa.clasificacion.tiempoCaptura,t.asyncSearchAPI.invoking(e),t.post(o.URL.post_clasificacion,a.clasificacion,(function(n){n.data&&n.data.success?(a.$parent.etapaCompletada(),g_utils.prompt_msg(o.MSG.ETAPA_COMPLETA,(function(){a.$apply((function(){a.$emit(o.EVENTOS.clasificacion_complete,{idNota:a.clasificacion.idNota}),i.path("/clasificacion")}))}))):c(),t.asyncSearchAPI.success(e)}),(function(){t.asyncSearchAPI.error(e),c()})))}}]);